<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾æ™¯éšäº« - ç²¾ç¾é£æ™¯å›¾ç‰‡é›†</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff1493;
            --primary-light: #ff69b4;
            --secondary: #667eea;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 20px 60px rgba(0,0,0,0.15);
            --radius: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: #f5f5f5;
            overflow-x: hidden;
            -webkit-touch-callout: none;
        }
        
        /* è™šæ‹Ÿå…‰æ ‡ */
        #gamepadCursor {
            position: fixed;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.6));
            border: 3px solid rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            pointer-events: none;
            z-index: 99999;
            display: none;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.6), 0 0 40px rgba(118, 75, 162, 0.4);
            transition: transform 0.05s ease;
        }
        
        #gamepadCursor.active {
            display: block;
        }
        
        #gamepadCursor::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }
        
        /* æ‰‹æŸ„è¿æ¥æç¤º */
        .gamepad-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            z-index: 100000;
            display: none;
            animation: slideInRight 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .gamepad-toast.show {
            display: block;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* é£æ™¯ç•Œé¢ */
        #landscapeView {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .landscape-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .landscape-title {
            text-align: center;
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }
        
        .landscape-subtitle {
            text-align: center;
            color: #718096;
            margin-top: 8px;
            font-size: 1em;
        }
        
        .landscape-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .image-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .image-card:hover, .image-card.gamepad-hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }
        
        .image-wrapper {
            position: relative;
            width: 100%;
            height: 300px;
            overflow: hidden;
            background: #e2e8f0;
        }
        
        .image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .image-card:hover img {
            transform: scale(1.1);
        }
        
        .image-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #cbd5e0;
            font-size: 1.2em;
        }
        
        .image-info {
            padding: 20px;
        }
        
        .image-author {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }
        
        .image-dimensions {
            color: #718096;
            font-size: 0.9em;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 40px;
            right: 40px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            font-size: 1.8em;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        
        .refresh-btn:hover, .refresh-btn.gamepad-hover {
            transform: rotate(180deg) scale(1.1);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        
        .landscape-footer {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            text-align: center;
            color: #718096;
            margin-top: 60px;
        }
        
        #secretTrigger {
            cursor: default;
        }
        
        .stone-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }
        
        .stone-modal.active {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .stone-drop {
            font-size: 8em;
            animation: stoneDrop 1s ease-out;
        }
        
        @keyframes stoneDrop {
            0% {
                transform: translateY(-500px) rotate(0deg);
                opacity: 0;
            }
            60% {
                transform: translateY(0) rotate(360deg);
                opacity: 1;
            }
            70% {
                transform: translateY(-50px) rotate(380deg);
            }
            80% {
                transform: translateY(0) rotate(360deg);
            }
            90% {
                transform: translateY(-20px) rotate(370deg);
            }
            100% {
                transform: translateY(0) rotate(360deg);
                opacity: 1;
            }
        }
        
        .hidden-stone {
            position: fixed;
            bottom: 120px;
            right: 40px;
            width: 50px;
            height: 50px;
            font-size: 2.5em;
            cursor: pointer;
            z-index: 60;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .hidden-stone.visible {
            display: block;
        }
        
        /* åŠŸèƒ½ç•Œé¢ */
        #appView {
            display: none;
        }
        
        #appView.active {
            display: block;
        }
        
        body.app-mode {
            background: var(--bg-gradient);
            padding: 20px;
            color: #2d3748;
        }
        
        .exit-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #fc8181, #f56565);
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(245, 101, 101, 0.4);
            transition: all 0.3s;
        }
        
        .exit-btn:hover, .exit-btn.gamepad-hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 101, 101, 0.6);
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 70px rgba(0,0,0,0.2);
        }
        
        .full-width { grid-column: 1 / -1; }
        
        header {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .logo {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(20deg); }
        }
        
        .version {
            color: #718096;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #4a5568;
            font-size: 0.95em;
        }
        
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        input[type="number"], select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1em;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
            background: white;
        }
        
        input[type="number"]:focus, select:focus, 
        input[type="number"].gamepad-focus, select.gamepad-focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.1);
            transform: scale(1.02);
        }
        
        .input-unit {
            position: absolute;
            right: 15px;
            color: #a0aec0;
            font-size: 0.9em;
            pointer-events: none;
        }
        
        .range-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #48bb78, #ecc94b, #f56565);
            outline: none;
            -webkit-appearance: none;
            margin-top: 10px;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        .toggle-section {
            background: linear-gradient(135deg, #e0f2fe, #bae6fd);
            border: 2px solid #7dd3fc;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: var(--transition);
        }
        
        .toggle-section.active {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-color: var(--success);
        }
        
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            flex: 1;
        }
        
        .checkbox-wrapper input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            position: relative;
            appearance: none;
            background: white;
            border: 3px solid #cbd5e0;
            border-radius: 6px;
            transition: var(--transition);
            flex-shrink: 0;
        }
        
        .checkbox-wrapper input[type="checkbox"]:hover,
        .checkbox-wrapper input[type="checkbox"].gamepad-hover {
            border-color: var(--primary-light);
            transform: scale(1.1);
        }
        
        .checkbox-wrapper input[type="checkbox"]:checked {
            background: linear-gradient(135deg, var(--success), #38a169);
            border-color: var(--success);
        }
        
        .checkbox-wrapper input[type="checkbox"]:checked::before {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 16px;
            font-weight: bold;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.05em;
            font-weight: 600;
            color: #0c4a6e;
        }
        
        .toggle-icon {
            font-size: 1.8em;
        }
        
        .toggle-status {
            font-size: 0.85em;
            color: #64748b;
            margin-top: 8px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.6);
            border-radius: 8px;
        }
        
        .toggle-status.enabled {
            color: #065f46;
            background: rgba(167, 243, 208, 0.5);
        }
        
        .settings-history {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .settings-history h4 {
            color: #92400e;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        
        .history-item {
            background: rgba(255,255,255,0.7);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.85em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-timestamp {
            color: #78350f;
            font-size: 0.8em;
        }
        
        .history-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-mini {
            padding: 4px 10px;
            font-size: 0.75em;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .btn-restore {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            color: white;
        }
        
        .btn-delete {
            background: linear-gradient(135deg, #fca5a5, #f87171);
            color: white;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
            box-shadow: 0 4px 15px rgba(255, 20, 147, 0.3);
        }
        
        .btn-primary:hover:not(:disabled),
        .btn-primary.gamepad-hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 20, 147, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled),
        .btn-secondary.gamepad-hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #fc8181, #f56565);
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid rgba(255, 105, 180, 0.2);
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-light), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #718096;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-light), var(--primary));
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer-progress 2s infinite;
        }
        
        @keyframes shimmer-progress {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .log-container {
            height: 400px;
            overflow-y: auto;
            background: #f7fafc;
            border-radius: 12px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            border: 2px solid #e2e8f0;
        }
        
        .log-entry {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .log-icon {
            font-size: 1.2em;
        }
        
        .log-insert {
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            border-left: 4px solid #f56565;
        }
        
        .log-withdraw {
            background: linear-gradient(135deg, #bee3f8, #90cdf4);
            border-left: 4px solid #4299e1;
        }
        
        .log-info {
            background: linear-gradient(135deg, #feebc8, #fbd38d);
            border-left: 4px solid #ed8936;
        }
        
        .log-success {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            border-left: 4px solid #48bb78;
        }
        
        .log-motivation {
            background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
            border-left: 4px solid #6366f1;
        }
        
        .safety-alert {
            border: 2px solid;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .safety-alert.high {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-color: var(--success);
        }
        
        .safety-alert.medium {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-color: var(--warning);
        }
        
        .safety-alert.low {
            background: linear-gradient(135deg, #fed7d7, #fecaca);
            border-color: var(--danger);
        }
        
        .safety-icon {
            font-size: 1.5em;
        }
        
        .calculation-result {
            background: linear-gradient(135deg, #e6fffa, #b2f5ea);
            border: 2px solid #4fd1c5;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(79, 209, 197, 0.3);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-value {
            font-weight: 600;
            color: var(--primary);
        }
        
        .chart-container {
            height: 200px;
            display: flex;
            align-items: flex-end;
            gap: 5px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 12px;
        }
        
        .chart-bar {
            flex: 1;
            background: linear-gradient(to top, var(--primary-light), var(--primary));
            border-radius: 4px 4px 0 0;
            transition: var(--transition);
            position: relative;
        }
        
        .chart-bar:hover {
            opacity: 0.8;
            transform: scaleY(1.05);
        }
        
        .health-report {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 3px solid #f59e0b;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            animation: slideDown 0.5s ease;
        }
        
        .health-report h3 {
            color: #92400e;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .health-item {
            background: rgba(255,255,255,0.7);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #f59e0b;
        }
        
        .health-item strong {
            color: #92400e;
        }
        
        .care-tips {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .care-tips h4 {
            color: #1e40af;
            margin-bottom: 12px;
        }
        
        .care-tips ul {
            list-style: none;
            padding: 0;
        }
        
        .care-tips li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .care-tips li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #3b82f6;
            font-weight: bold;
        }
        
        .hidden { display: none !important; }
        
        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5em;
            animation: celebrate 1s ease-out;
            pointer-events: none;
            z-index: 1000;
        }
        
        @keyframes celebrate {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        /* å“åº”å¼è®¾è®¡ - å¹³æ¿ */
        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 20px;
            }
            
            .landscape-title {
                font-size: 2em;
            }
            
            .logo {
                font-size: 2em;
            }
        }
        
        /* å“åº”å¼è®¾è®¡ - æ‰‹æœº */
        @media (max-width: 768px) {
            body.app-mode {
                padding: 10px;
            }
            
            .app-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            .logo {
                font-size: 1.8em;
            }
            
            .gallery-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .landscape-title {
                font-size: 1.8em;
            }
            
            .landscape-container {
                padding: 20px 10px;
            }
            
            .refresh-btn {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 20px;
                font-size: 1.5em;
            }
            
            .hidden-stone {
                bottom: 90px;
                right: 20px;
                font-size: 2em;
            }
            
            .exit-btn {
                top: 10px;
                right: 10px;
                padding: 10px 20px;
                font-size: 0.9em;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-value {
                font-size: 2em;
            }
            
            .log-container {
                height: 300px;
                font-size: 0.8em;
            }
            
            .gamepad-toast {
                top: 10px;
                right: 10px;
                left: 10px;
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            #gamepadCursor {
                width: 40px;
                height: 40px;
                border-width: 4px;
            }
        }
        
        /* å“åº”å¼è®¾è®¡ - å°æ‰‹æœº */
        @media (max-width: 480px) {
            .landscape-title {
                font-size: 1.5em;
            }
            
            .logo {
                font-size: 1.5em;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            .form-group label {
                font-size: 0.9em;
            }
            
            input[type="number"], select {
                padding: 12px 15px;
                font-size: 0.95em;
            }
        }
    </style>
</head>
<body>
    <!-- è™šæ‹Ÿå…‰æ ‡ -->
    <div id="gamepadCursor"></div>
    
    <!-- æ‰‹æŸ„è¿æ¥æç¤º -->
    <div class="gamepad-toast" id="gamepadToast"></div>
    
    <!-- çŸ³å¤´æ‰è½å¼¹çª— -->
    <div class="stone-modal" id="stoneModal">
        <div class="stone-drop">ğŸª¨</div>
    </div>
    
    <!-- éšè—çš„çŸ³å¤´æŒ‰é’® -->
    <div class="hidden-stone" id="hiddenStone">ğŸª¨</div>
    
    <!-- é£æ™¯ç•Œé¢ -->
    <div id="landscapeView">
        <div class="landscape-header">
            <h1 class="landscape-title">ğŸŒ„ ç¾æ™¯éšäº«</h1>
            <p class="landscape-subtitle">å‘ç°ä¸–ç•Œå„åœ°çš„ç²¾ç¾é£æ™¯ç…§ç‰‡</p>
        </div>
        
        <div class="landscape-container">
            <div class="gallery-grid" id="gallery"></div>
        </div>
        
        <button class="refresh-btn" onclick="refreshGallery()" title="åˆ·æ–°å›¾ç‰‡">
            ğŸ”„
        </button>
        
        <div class="landscape-footer">
            <p>å›¾ç‰‡æ¥æº: Lorem Picsum | æ¯æ¬¡åˆ·æ–°éƒ½æœ‰æ–°æƒŠå–œ</p>
            <p style="margin-top: 10px; font-size: 0.9em;">Â© 2025 ç¾æ™¯éšäº«. All <span id="secretTrigger">r</span>ights reserved.</p>
        </div>
    </div>

    <!-- åŠŸèƒ½ç•Œé¢ -->
    <div id="appView">
        <button class="exit-btn" onclick="exitApp()">â† è¿”å›é£æ™¯</button>
        
        <div class="app-container">
            <div class="card full-width">
                <header>
                    <div class="logo">â™¥ PLEASURE ANALYTICS PRO â™¥</div>
                    <div class="version">Version 5.0 - æ™ºèƒ½è®¡ç®— | è®¾ç½®è®°å¿† | å¥åº·ç›‘æµ‹</div>
                </header>
            </div>

            <div class="card">
                <h2 style="margin-bottom: 20px; color: var(--primary);">âš™ï¸ å‚æ•°è®¾ç½®</h2>
                
                <div class="toggle-section" id="lubeSection">
                    <div class="toggle-row">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="useLube" onchange="toggleLube()">
                            <div class="checkbox-label">
                                <span class="toggle-icon">ğŸ’§</span>
                                <span>ä½¿ç”¨æ¶¦æ»‘å‰‚</span>
                            </div>
                        </label>
                    </div>
                    <div class="toggle-status" id="lubeStatus">æœªä½¿ç”¨æ¶¦æ»‘å‰‚</div>
                </div>
                
                <div class="toggle-section" id="tipsSection">
                    <div class="toggle-row">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="showMotivation" checked onchange="toggleMotivation()">
                            <div class="checkbox-label">
                                <span class="toggle-icon">ğŸ’¬</span>
                                <span>ä¸­é€”é¼“åŠ±æç¤º</span>
                            </div>
                        </label>
                    </div>
                    <div class="toggle-status enabled" id="motivationStatus">å·²å¼€å¯</div>
                </div>
                
                <div class="form-group">
                    <label>ç©å…·é•¿åº¦ (cm)</label>
                    <div class="input-wrapper">
                        <input type="number" id="toyLength" min="1" max="150" step="0.1" value="15" onchange="saveSettings()">
                        <span class="input-unit">cm</span>
                    </div>
                    <input type="range" class="range-slider" id="lengthSlider" min="1" max="150" step="0.1" value="15">
                </div>
                
                <div class="form-group">
                    <label>ç©å…·ç›´å¾„ (cm)</label>
                    <div class="input-wrapper">
                        <input type="number" id="toyDiameter" min="0.5" max="10" step="0.1" value="3" onchange="saveSettings()">
                        <span class="input-unit">cm</span>
                    </div>
                    <input type="range" class="range-slider" id="diameterSlider" min="0.5" max="10" step="0.1" value="3">
                </div>
                
                <div class="form-group">
                    <label>ä½¿ç”¨æ¬¡æ•°</label>
                    <div class="input-wrapper">
                        <input type="number" id="totalCount" min="2" max="100" step="2" value="10" onchange="saveSettings()">
                        <span class="input-unit">æ¬¡</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ä½¿ç”¨ç»éªŒ</label>
                    <select id="experience" onchange="saveSettings()">
                        <option value="beginner">åˆå­¦è€…</option>
                        <option value="intermediate" selected>ä¸­çº§è€…</option>
                        <option value="advanced">é«˜çº§è€…</option>
                        <option value="expert">ä¸“å®¶çº§</option>
                    </select>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="calculateParams()">
                        ğŸ§® æ™ºèƒ½è®¡ç®—
                    </button>
                    <button class="btn btn-primary" id="startBtn" onclick="startSession()" disabled>
                        â–¶ï¸ å¼€å§‹ä¼šè¯
                    </button>
                </div>
                
                <div id="calculationResult" class="hidden"></div>
                <div id="safetyAlert" class="hidden"></div>
                
                <div class="settings-history hidden" id="settingsHistory">
                    <h4>ğŸ“‹ æœ€è¿‘è®¾ç½®è®°å½•</h4>
                    <div id="historyList"></div>
                    <div style="text-align: center; margin-top: 10px;">
                        <button class="btn-mini" style="background: #64748b; color: white;" onclick="clearAllHistory()">
                            æ¸…ç©ºæ‰€æœ‰è®°å½•
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 style="margin-bottom: 20px; color: var(--primary);">ğŸ“Š å®æ—¶ç»Ÿè®¡</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-label">è¿è¡Œæ—¶é—´</div>
                        <div class="stat-value" id="timer">00:00:00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å®Œæˆè¿›åº¦</div>
                        <div class="stat-value" id="progress">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ’å…¥æ¬¡æ•°</div>
                        <div class="stat-value" id="insertCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å‰©ä½™æ—¶é—´</div>
                        <div class="stat-value" id="remaining">--:--</div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                    </div>
                </div>
                
                <div class="btn-group hidden" id="controlButtons">
                    <button class="btn btn-secondary" onclick="pauseSession()">
                        â¸ï¸ <span id="pauseText">æš‚åœ</span>
                    </button>
                    <button class="btn btn-danger" onclick="stopSession()">
                        â¹ï¸ åœæ­¢
                    </button>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3 style="font-size: 1em; color: #4a5568; margin-bottom: 10px;">ä¼šè¯å†å²</h3>
                    <div class="chart-container" id="historyChart">
                        <div style="text-align: center; width: 100%; color: #a0aec0;">æš‚æ— æ•°æ®</div>
                    </div>
                </div>
            </div>

            <div class="card full-width">
                <h2 style="margin-bottom: 15px; color: var(--primary);">ğŸ“ æ´»åŠ¨æ—¥å¿—</h2>
                <div class="log-container" id="logContainer">
                    <div class="log-entry log-info">
                        <span class="log-icon">â„¹ï¸</span>
                        <span>ç³»ç»Ÿå°±ç»ª - æ‚¨çš„è®¾ç½®ä¼šè‡ªåŠ¨ä¿å­˜</span>
                    </div>
                </div>
                
                <div id="healthReport" class="hidden"></div>
            </div>
        </div>
    </div>

    <script>
        // ç¦æ­¢å¤åˆ¶
        document.addEventListener('contextmenu', (e) => e.preventDefault());
        document.addEventListener('copy', (e) => e.preventDefault());
        document.addEventListener('cut', (e) => e.preventDefault());
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'C' || e.key === 'x' || e.key === 'X' || e.key === 'a' || e.key === 'A')) {
                e.preventDefault();
            }
        });
        
        // ========== æ‰‹æŸ„æ§åˆ¶ç³»ç»Ÿ ==========
        const GamepadController = {
            connected: false,
            gamepad: null,
            cursorX: window.innerWidth / 2,
            cursorY: window.innerHeight / 2,
            lastButtons: [],
            scrollSpeed: 20,
            cursorSpeed: 8,
            deadzone: 0.15,
            updateInterval: null,
            
            init() {
                window.addEventListener('gamepadconnected', (e) => this.onConnect(e));
                window.addEventListener('gamepaddisconnected', (e) => this.onDisconnect(e));
                this.checkGamepads();
            },
            
            checkGamepads() {
                const gamepads = navigator.getGamepads();
                if (gamepads && gamepads[0]) {
                    if (!this.connected) {
                        this.onConnect({ gamepad: gamepads[0] });
                    }
                }
            },
            
            onConnect(e) {
                this.connected = true;
                this.gamepad = e.gamepad;
                this.showToast(`ğŸ® æ‰‹æŸ„å·²è¿æ¥: ${e.gamepad.id}`);
                this.showCursor();
                this.startUpdate();
            },
            
            onDisconnect(e) {
                this.connected = false;
                this.showToast('âŒ æ‰‹æŸ„å·²æ–­å¼€');
                this.hideCursor();
                this.stopUpdate();
            },
            
            showToast(message) {
                const toast = document.getElementById('gamepadToast');
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            },
            
            showCursor() {
                const cursor = document.getElementById('gamepadCursor');
                cursor.classList.add('active');
                cursor.style.left = this.cursorX + 'px';
                cursor.style.top = this.cursorY + 'px';
            },
            
            hideCursor() {
                document.getElementById('gamepadCursor').classList.remove('active');
            },
            
            startUpdate() {
                if (this.updateInterval) return;
                this.updateInterval = setInterval(() => this.update(), 16);
            },
            
            stopUpdate() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                    this.updateInterval = null;
                }
            },
            
            update() {
                const gamepads = navigator.getGamepads();
                if (!gamepads || !gamepads[0]) return;
                
                const gp = gamepads[0];
                
                // å·¦æ‘‡æ† - æ§åˆ¶å…‰æ ‡
                const leftX = this.applyDeadzone(gp.axes[0]);
                const leftY = this.applyDeadzone(gp.axes[1]);
                
                if (leftX !== 0 || leftY !== 0) {
                    this.cursorX += leftX * this.cursorSpeed;
                    this.cursorY += leftY * this.cursorSpeed;
                    
                    this.cursorX = Math.max(0, Math.min(window.innerWidth, this.cursorX));
                    this.cursorY = Math.max(0, Math.min(window.innerHeight, this.cursorY));
                    
                    const cursor = document.getElementById('gamepadCursor');
                    cursor.style.left = this.cursorX + 'px';
                    cursor.style.top = this.cursorY + 'px';
                    
                    this.updateHoverElement();
                }
                
                // å³æ‘‡æ† - ä¸Šä¸‹ç¿»é¡µ
                const rightY = this.applyDeadzone(gp.axes[3]);
                if (Math.abs(rightY) > 0) {
                    window.scrollBy(0, rightY * this.scrollSpeed);
                }
                
                // æŒ‰é’®å¤„ç†
                this.handleButtons(gp);
            },
            
            applyDeadzone(value) {
                return Math.abs(value) < this.deadzone ? 0 : value;
            },
            
            updateHoverElement() {
                const element = document.elementFromPoint(this.cursorX, this.cursorY);
                
                // ç§»é™¤æ‰€æœ‰æ‚¬åœæ•ˆæœ
                document.querySelectorAll('.gamepad-hover').forEach(el => {
                    el.classList.remove('gamepad-hover');
                });
                
                // æ·»åŠ æ‚¬åœæ•ˆæœ
                if (element) {
                    if (element.matches('button, a, input, select, .image-card, .btn-mini')) {
                        element.classList.add('gamepad-hover');
                    }
                }
            },
            
            handleButtons(gp) {
                const buttons = gp.buttons;
                
                // Aé”® (0) - ç¡®è®¤/ç‚¹å‡»
                if (this.isButtonPressed(buttons[0], 0)) {
                    this.simulateClick();
                }
                
                // Bé”® (1) - é€€å‡ºéšè—ç•Œé¢
                if (this.isButtonPressed(buttons[1], 1)) {
                    if (document.getElementById('appView').classList.contains('active')) {
                        exitApp();
                    }
                }
                
                // Xé”® (2) - åˆ·æ–°ç½‘é¡µ
                if (this.isButtonPressed(buttons[2], 2)) {
                    location.reload();
                }
                
                // RT (å³æ‰³æœº) (7) - å¼€å§‹ä¼šè¯
                if (this.isButtonPressed(buttons[7], 7)) {
                    if (document.getElementById('appView').classList.contains('active')) {
                        const startBtn = document.getElementById('startBtn');
                        if (!startBtn.disabled) {
                            startSession();
                        }
                    }
                }
                
                // RB (å³è‚©é”®) (5) - åœæ­¢ä¼šè¯
                if (this.isButtonPressed(buttons[5], 5)) {
                    if (document.getElementById('appView').classList.contains('active')) {
                        if (session.isRunning) {
                            stopSession();
                        }
                    }
                }
                
                this.lastButtons = buttons.map(b => b.pressed);
            },
            
            isButtonPressed(button, index) {
                const pressed = button.pressed;
                const wasPressed = this.lastButtons[index] || false;
                return pressed && !wasPressed;
            },
            
            simulateClick() {
                const element = document.elementFromPoint(this.cursorX, this.cursorY);
                if (element) {
                    element.click();
                }
            }
        };
        
        // ========== ç§˜å¯†è§¦å‘æœºåˆ¶ ==========
        let triggerClickCount = 0;
        let stoneClickCount = 0;
        let stoneVisible = false;
        
        document.getElementById('secretTrigger').addEventListener('click', function(e) {
            e.stopPropagation();
            triggerClickCount++;
            
            if (triggerClickCount >= 10) {
                showStoneModal();
                triggerClickCount = 0;
            }
        });
        
        function showStoneModal() {
            const modal = document.getElementById('stoneModal');
            modal.classList.add('active');
            
            setTimeout(() => {
                modal.classList.remove('active');
                showHiddenStone();
            }, 2000);
        }
        
        function showHiddenStone() {
            const stone = document.getElementById('hiddenStone');
            stone.classList.add('visible');
            stoneVisible = true;
        }
        
        document.getElementById('hiddenStone').addEventListener('click', function(e) {
            e.stopPropagation();
            if (!stoneVisible) return;
            
            stoneClickCount++;
            
            if (stoneClickCount >= 10) {
                enterApp();
                stoneClickCount = 0;
                this.classList.remove('visible');
                stoneVisible = false;
            }
        });
        
        // ========== é£æ™¯ç•Œé¢é€»è¾‘ ==========
        function loadGallery() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            
            for (let i = 0; i < 12; i++) {
                const randomId = Math.floor(Math.random() * 1000);
                createImageCard(randomId, gallery);
            }
        }
        
        function createImageCard(id, container) {
            const card = document.createElement('div');
            card.className = 'image-card';
            
            const wrapper = document.createElement('div');
            wrapper.className = 'image-wrapper';
            
            const loading = document.createElement('div');
            loading.className = 'image-loading spinner';
            loading.textContent = 'â³';
            wrapper.appendChild(loading);
            
            const img = document.createElement('img');
            img.src = `https://picsum.photos/id/${id}/400/300`;
            img.alt = 'é£æ™¯ç…§ç‰‡';
            img.style.display = 'none';
            
            img.onload = function() {
                loading.style.display = 'none';
                img.style.display = 'block';
            };
            
            img.onerror = function() {
                loading.textContent = 'âŒ';
                loading.classList.remove('spinner');
            };
            
            wrapper.appendChild(img);
            card.appendChild(wrapper);
            
            const info = document.createElement('div');
            info.className = 'image-info';
            info.innerHTML = `
                <div class="image-author">Image #${id}</div>
                <div class="image-dimensions">400 Ã— 300 px</div>
            `;
            card.appendChild(info);
            
            container.appendChild(card);
        }
        
        function refreshGallery() {
            loadGallery();
        }
        
        function enterApp() {
            document.getElementById('landscapeView').style.display = 'none';
            document.getElementById('appView').classList.add('active');
            document.body.classList.add('app-mode');
            loadSettings();
            loadSessionHistory();
            displaySettingsHistory();
        }
        
        function exitApp() {
            document.getElementById('landscapeView').style.display = 'block';
            document.getElementById('appView').classList.remove('active');
            document.body.classList.remove('app-mode');
            
            triggerClickCount = 0;
            stoneClickCount = 0;
            document.getElementById('hiddenStone').classList.remove('visible');
            stoneVisible = false;
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            loadGallery();
            GamepadController.init();
        });
        
        // ========== åŠŸèƒ½ç•Œé¢é€»è¾‘ï¼ˆä¿æŒå®Œæ•´ä»£ç ï¼‰ ==========
        const StorageManager = {
            KEYS: {
                CURRENT_SETTINGS: 'pleasureAnalytics_currentSettings',
                SETTINGS_HISTORY: 'pleasureAnalytics_settingsHistory',
                SESSION_HISTORY: 'pleasureAnalytics_sessionHistory'
            },
            
            isAvailable() {
                try {
                    const test = '__storage_test__';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch(e) {
                    return false;
                }
            },
            
            saveCurrentSettings(settings) {
                if (!this.isAvailable()) return false;
                try {
                    localStorage.setItem(this.KEYS.CURRENT_SETTINGS, JSON.stringify(settings));
                    return true;
                } catch(e) {
                    return false;
                }
            },
            
            loadCurrentSettings() {
                if (!this.isAvailable()) return null;
                try {
                    const data = localStorage.getItem(this.KEYS.CURRENT_SETTINGS);
                    return data ? JSON.parse(data) : null;
                } catch(e) {
                    return null;
                }
            },
            
            addToHistory(settings) {
                if (!this.isAvailable()) return false;
                try {
                    let history = this.getSettingsHistory();
                    const newEntry = {
                        ...settings,
                        timestamp: new Date().toISOString(),
                        id: Date.now()
                    };
                    
                    history.unshift(newEntry);
                    
                    if (history.length > 10) {
                        history = history.slice(0, 10);
                    }
                    
                    localStorage.setItem(this.KEYS.SETTINGS_HISTORY, JSON.stringify(history));
                    return true;
                } catch(e) {
                    return false;
                }
            },
            
            getSettingsHistory() {
                if (!this.isAvailable()) return [];
                try {
                    const data = localStorage.getItem(this.KEYS.SETTINGS_HISTORY);
                    return data ? JSON.parse(data) : [];
                } catch(e) {
                    return [];
                }
            },
            
            deleteHistoryItem(id) {
                if (!this.isAvailable()) return false;
                try {
                    let history = this.getSettingsHistory();
                    history = history.filter(item => item.id !== id);
                    localStorage.setItem(this.KEYS.SETTINGS_HISTORY, JSON.stringify(history));
                    return true;
                } catch(e) {
                    return false;
                }
            },
            
            clearHistory() {
                if (!this.isAvailable()) return false;
                try {
                    localStorage.removeItem(this.KEYS.SETTINGS_HISTORY);
                    return true;
                } catch(e) {
                    return false;
                }
            },
            
            saveSessionHistory(history) {
                if (!this.isAvailable()) return false;
                try {
                    localStorage.setItem(this.KEYS.SESSION_HISTORY, JSON.stringify(history));
                    return true;
                } catch(e) {
                    return false;
                }
            },
            
            loadSessionHistory() {
                if (!this.isAvailable()) return [];
                try {
                    const data = localStorage.getItem(this.KEYS.SESSION_HISTORY);
                    return data ? JSON.parse(data) : [];
                } catch(e) {
                    return [];
                }
            }
        };
        
        let config = {
            length: 15,
            diameter: 3,
            useLube: false,
            showMotivation: true,
            totalCount: 10,
            experience: 'intermediate',
            actionDelay: 0,
            safetyScore: 100,
            originalDelay: 0
        };
        
        let session = {
            isRunning: false,
            isPaused: false,
            currentCycle: 0,
            insertions: 0,
            startTime: 0,
            pauseTime: 0,
            totalPauseTime: 0,
            intervalId: null,
            timerInterval: null,
            motivationShown: 0
        };
        
        let history = [];
        
        const EXP_MULTIPLIER = {
            beginner: 1.5,
            intermediate: 1.0,
            advanced: 0.7,
            expert: 0.5
        };
        
        const MOTIVATION_MESSAGES = [
            'ğŸ’ª åšå¾—å¾ˆå¥½ï¼ç»§ç»­ä¿æŒæ¸©æŸ”çš„èŠ‚å¥',
            'ğŸŒŸ ä½ æ­£åœ¨äº«å—ç¾å¥½çš„æ—¶å…‰ï¼Œæ”¾æ¾èº«å¿ƒ',
            'âœ¨ æ³¨æ„å‘¼å¸ï¼Œè®©èº«ä½“è‡ªç„¶æ”¾æ¾',
            'ğŸ’– æ„Ÿå—æ¯ä¸€æ¬¡æ„‰æ‚¦ï¼Œäº«å—å½“ä¸‹',
            'ğŸ¯ èŠ‚å¥å¾ˆæ£’ï¼ç»§ç»­ä¿æŒè¿™ä¸ªçŠ¶æ€',
            'ğŸŒˆ ä½ åšå¾—éå¸¸å¥½ï¼Œèº«ä½“æ­£åœ¨é€‚åº”',
            'ğŸ’« æ”¾æ¾è‚Œè‚‰ï¼Œè®©ä¸€åˆ‡è‡ªç„¶æµåŠ¨',
            'ğŸ¦‹ æ¸©æŸ”è€Œå……æ»¡è€å¿ƒï¼Œè¿™å¾ˆå®Œç¾',
            'ğŸŒ¸ ä½ æ­£åœ¨ç…§é¡¾å¥½è‡ªå·±çš„èº«ä½“',
            'â­ ç»§ç»­ä¿æŒï¼Œä½ åšå¾—å¾ˆæ£’ï¼'
        ];
        
        function loadSettings() {
            const saved = StorageManager.loadCurrentSettings();
            if (saved) {
                config = { ...config, ...saved };
                
                document.getElementById('toyLength').value = config.length;
                document.getElementById('lengthSlider').value = config.length;
                document.getElementById('toyDiameter').value = config.diameter;
                document.getElementById('diameterSlider').value = config.diameter;
                document.getElementById('totalCount').value = config.totalCount;
                document.getElementById('experience').value = config.experience;
                document.getElementById('useLube').checked = config.useLube;
                document.getElementById('showMotivation').checked = config.showMotivation;
                
                toggleLube();
                toggleMotivation();
            }
        }
        
        function saveSettings() {
            config.length = parseFloat(document.getElementById('toyLength').value);
            config.diameter = parseFloat(document.getElementById('toyDiameter').value);
            config.totalCount = parseInt(document.getElementById('totalCount').value);
            config.experience = document.getElementById('experience').value;
            
            StorageManager.saveCurrentSettings(config);
        }
        
        function saveToHistory() {
            const settingsSnapshot = {
                length: config.length,
                diameter: config.diameter,
                totalCount: config.totalCount,
                experience: config.experience,
                useLube: config.useLube,
                showMotivation: config.showMotivation
            };
            
            StorageManager.addToHistory(settingsSnapshot);
            displaySettingsHistory();
            showLog('ğŸ’¾ å½“å‰è®¾ç½®å·²ä¿å­˜åˆ°å†å²è®°å½•', 'success');
        }
        
        function displaySettingsHistory() {
            const historyList = document.getElementById('historyList');
            const historySection = document.getElementById('settingsHistory');
            const settingsHistory = StorageManager.getSettingsHistory();
            
            if (settingsHistory.length === 0) {
                historySection.classList.add('hidden');
                return;
            }
            
            historySection.classList.remove('hidden');
            historyList.innerHTML = '';
            
            settingsHistory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                
                const date = new Date(item.timestamp);
                const timeStr = date.toLocaleString('zh-CN', {
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                div.innerHTML = `
                    <div>
                        <div>${item.length}cm Ã— ${item.diameter}cm | ${item.totalCount}æ¬¡ | ${getExpText(item.experience)}</div>
                        <div>
                            ${item.useLube ? 'ğŸ’§' : 'âŒ'} 
                            ${item.showMotivation ? 'ğŸ’¬' : 'ğŸ”‡'}
                        </div>
                        <div class="history-timestamp">${timeStr}</div>
                    </div>
                    <div class="history-actions">
                        <button class="btn-mini btn-restore" onclick="restoreSettings(${item.id})">æ¢å¤</button>
                        <button class="btn-mini btn-delete" onclick="deleteHistoryItem(${item.id})">åˆ é™¤</button>
                    </div>
                `;
                
                historyList.appendChild(div);
            });
        }
        
        function restoreSettings(id) {
            const settingsHistory = StorageManager.getSettingsHistory();
            const item = settingsHistory.find(s => s.id === id);
            
            if (item) {
                config = { ...config, ...item };
                
                document.getElementById('toyLength').value = config.length;
                document.getElementById('lengthSlider').value = config.length;
                document.getElementById('toyDiameter').value = config.diameter;
                document.getElementById('diameterSlider').value = config.diameter;
                document.getElementById('totalCount').value = config.totalCount;
                document.getElementById('experience').value = config.experience;
                document.getElementById('useLube').checked = config.useLube;
                document.getElementById('showMotivation').checked = config.showMotivation;
                
                toggleLube();
                toggleMotivation();
                
                saveSettings();
                showLog('ğŸ”„ è®¾ç½®å·²æ¢å¤', 'success');
            }
        }
        
        function deleteHistoryItem(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                StorageManager.deleteHistoryItem(id);
                displaySettingsHistory();
                showLog('ğŸ—‘ï¸ è®°å½•å·²åˆ é™¤', 'info');
            }
        }
        
        function clearAllHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                StorageManager.clearHistory();
                displaySettingsHistory();
                showLog('ğŸ—‘ï¸ æ‰€æœ‰å†å²è®°å½•å·²æ¸…ç©º', 'info');
            }
        }
        
        function loadSessionHistory() {
            history = StorageManager.loadSessionHistory();
            if (history.length > 0) {
                updateHistoryChart();
            }
        }
        
        function saveSessionHistory() {
            StorageManager.saveSessionHistory(history);
        }
        
        function getExpText(exp) {
            const texts = {
                beginner: 'åˆå­¦',
                intermediate: 'ä¸­çº§',
                advanced: 'é«˜çº§',
                expert: 'ä¸“å®¶'
            };
            return texts[exp] || exp;
        }
        
        document.getElementById('lengthSlider').addEventListener('input', (e) => {
            document.getElementById('toyLength').value = e.target.value;
            saveSettings();
        });
        
        document.getElementById('toyLength').addEventListener('input', (e) => {
            document.getElementById('lengthSlider').value = e.target.value;
        });
        
        document.getElementById('diameterSlider').addEventListener('input', (e) => {
            document.getElementById('toyDiameter').value = e.target.value;
            saveSettings();
        });
        
        document.getElementById('toyDiameter').addEventListener('input', (e) => {
            document.getElementById('diameterSlider').value = e.target.value;
        });
        
        function toggleLube() {
            config.useLube = document.getElementById('useLube').checked;
            const status = document.getElementById('lubeStatus');
            const section = document.getElementById('lubeSection');
            
            if (config.useLube) {
                status.textContent = 'âœ… å·²ä½¿ç”¨æ¶¦æ»‘å‰‚ - æ‘©æ“¦åŠ›é™ä½30%';
                status.classList.add('enabled');
                section.classList.add('active');
            } else {
                status.textContent = 'æœªä½¿ç”¨æ¶¦æ»‘å‰‚';
                status.classList.remove('enabled');
                section.classList.remove('active');
            }
            
            saveSettings();
        }
        
        function toggleMotivation() {
            config.showMotivation = document.getElementById('showMotivation').checked;
            const status = document.getElementById('motivationStatus');
            const section = document.getElementById('tipsSection');
            
            if (config.showMotivation) {
                status.textContent = 'å·²å¼€å¯ - ä¼šæ˜¾ç¤ºé¼“åŠ±æç¤º';
                status.classList.add('enabled');
                section.classList.add('active');
            } else {
                status.textContent = 'å·²å…³é—­';
                status.classList.remove('enabled');
                section.classList.remove('active');
            }
            
            saveSettings();
        }
        
        function calculateParams() {
            config.length = parseFloat(document.getElementById('toyLength').value);
            config.diameter = parseFloat(document.getElementById('toyDiameter').value);
            config.totalCount = parseInt(document.getElementById('totalCount').value);
            config.experience = document.getElementById('experience').value;
            
            if (config.length < 1 || config.length > 150) {
                showLog('âŒ é•¿åº¦å¿…é¡»åœ¨ 1-150cm ä¹‹é—´', 'info');
                return;
            }
            
            if (config.diameter < 0.5 || config.diameter > 10) {
                showLog('âŒ ç›´å¾„å¿…é¡»åœ¨ 0.5-10cm ä¹‹é—´', 'info');
                return;
            }
            
            if (config.totalCount % 2 !== 0) {
                config.totalCount++;
                document.getElementById('totalCount').value = config.totalCount;
            }
            
            const expMultiplier = EXP_MULTIPLIER[config.experience];
            
            let baseDelay = (config.length / 30) + (config.diameter / 3) + 1.2;
            baseDelay *= expMultiplier;
            config.originalDelay = baseDelay;
            
            if (config.useLube) {
                config.actionDelay = baseDelay * 0.70;
                showLog('ğŸ’§ æ¶¦æ»‘å‰‚æ•ˆæœ: é€Ÿåº¦æå‡ 30%', 'success');
            } else {
                config.actionDelay = baseDelay;
            }
            
            let safetyScore = 100;
            
            if (config.length > 100) safetyScore -= 20;
            else if (config.length > 50) safetyScore -= 10;
            
            if (config.diameter > 6) safetyScore -= 25;
            else if (config.diameter > 4) safetyScore -= 15;
            else if (config.diameter > 3) safetyScore -= 5;
            
            if (config.experience === 'beginner' && config.diameter > 4) safetyScore -= 10;
            
            if (config.useLube) {
                safetyScore += 20;
            } else {
                safetyScore -= 25;
            }
            
            config.safetyScore = Math.max(0, Math.min(100, safetyScore));
            
            displayCalculationResults();
            displaySafetyAlert();
            saveToHistory();
            
            document.getElementById('startBtn').disabled = false;
            showLog(`âœ… è®¡ç®—å®Œæˆ - é¢‘ç‡: ${config.actionDelay.toFixed(2)}ç§’/æ¬¡`, 'success');
        }
        
        function displayCalculationResults() {
            const totalTime = (config.totalCount * config.actionDelay / 60).toFixed(1);
            
            let html = `
                <div class="calculation-result">
                    <h3 style="color: #319795; margin-bottom: 15px;">ğŸ“‹ è®¡ç®—ç»“æœ</h3>
                    <div class="result-item">
                        <span>åŠ¨ä½œé¢‘ç‡:</span>
                        <span class="result-value">${config.actionDelay.toFixed(2)} ç§’/æ¬¡</span>
                    </div>
                    <div class="result-item">
                        <span>é¢„è®¡æ€»æ—¶é•¿:</span>
                        <span class="result-value">${totalTime} åˆ†é’Ÿ</span>
                    </div>
                    <div class="result-item">
                        <span>æ’å…¥æ¬¡æ•°:</span>
                        <span class="result-value">${config.totalCount / 2} æ¬¡</span>
                    </div>
                    <div class="result-item">
                        <span>å®‰å…¨è¯„åˆ†:</span>
                        <span class="result-value" style="color: ${getSafetyColor()}">${config.safetyScore}/100</span>
                    </div>
                </div>
            `;
            
            document.getElementById('calculationResult').innerHTML = html;
            document.getElementById('calculationResult').classList.remove('hidden');
        }
        
        function getSafetyColor() {
            if (config.safetyScore >= 80) return '#48bb78';
            if (config.safetyScore >= 60) return '#ecc94b';
            if (config.safetyScore >= 40) return '#ed8936';
            return '#f56565';
        }
        
        function getSafetyLevel() {
            if (config.safetyScore >= 80) return 'high';
            if (config.safetyScore >= 50) return 'medium';
            return 'low';
        }
        
        function displaySafetyAlert() {
            const level = getSafetyLevel();
            let icon = 'âœ…';
            let title = 'å®‰å…¨ç­‰çº§: ä¼˜ç§€';
            let message = 'å½“å‰é…ç½®éå¸¸å®‰å…¨ã€‚';
            
            if (level === 'medium') {
                icon = 'âš ï¸';
                title = 'å®‰å…¨ç­‰çº§: ä¸­ç­‰';
                message = 'å»ºè®®ä½¿ç”¨æ¶¦æ»‘å‰‚ï¼Œç¼“æ…¢è¿›è¡Œã€‚';
            } else if (level === 'low') {
                icon = 'ğŸš¨';
                title = 'å®‰å…¨ç­‰çº§: è¾ƒä½';
                message = 'å¼ºçƒˆå»ºè®®ä½¿ç”¨æ¶¦æ»‘å‰‚ï¼è¯·æåº¦ç¼“æ…¢è¿›è¡Œã€‚';
            }
            
            const html = `
                <div class="safety-alert ${level}">
                    <span class="safety-icon">${icon}</span>
                    <div>
                        <strong>${title}</strong><br>
                        ${message}
                    </div>
                </div>
            `;
            document.getElementById('safetyAlert').innerHTML = html;
            document.getElementById('safetyAlert').classList.remove('hidden');
        }
        
        async function startSession() {
            if (config.actionDelay === 0) {
                showLog('âŒ è¯·å…ˆè¿›è¡Œæ™ºèƒ½è®¡ç®—', 'info');
                return;
            }
            
            session = {
                isRunning: true,
                isPaused: false,
                currentCycle: 0,
                insertions: 0,
                startTime: performance.now(),
                pauseTime: 0,
                totalPauseTime: 0,
                intervalId: null,
                timerInterval: null,
                motivationShown: 0
            };
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('controlButtons').classList.remove('hidden');
            document.getElementById('healthReport').classList.add('hidden');
            
            clearLog();
            showLog('ğŸš€ ä¼šè¯å¼€å§‹ï¼', 'success');
            
            startTimer();
            runSession();
        }
        
        async function runSession() {
            while (session.currentCycle < config.totalCount && session.isRunning) {
                if (session.isPaused) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    continue;
                }
                
                session.currentCycle++;
                
                if (session.currentCycle % 2 === 1) {
                    session.insertions++;
                    const lubeText = config.useLube ? ' [æ¶¦æ»‘é¡ºç•…]' : '';
                    showLog(`â™¥ â¤â¤â¤ ç¬¬ ${session.insertions} æ¬¡æ’å…¥${lubeText}`, 'insert');
                    
                    if (config.showMotivation && session.insertions % 3 === 0) {
                        const randomMsg = MOTIVATION_MESSAGES[Math.floor(Math.random() * MOTIVATION_MESSAGES.length)];
                        await sleep(1000);
                        showLog(randomMsg, 'motivation');
                    }
                } else {
                    showLog(`â™¥ âŸµâŸµâŸµ å®Œå…¨æ‹”å‡º`, 'withdraw');
                }
                
                updateStats();
                await sleep(config.actionDelay * 1000);
            }
            
            if (session.isRunning) {
                completeSession();
            }
        }
        
        function pauseSession() {
            session.isPaused = !session.isPaused;
            const pauseBtn = document.getElementById('pauseText');
            
            if (session.isPaused) {
                session.pauseTime = performance.now();
                pauseBtn.textContent = 'ç»§ç»­';
                showLog('â¸ï¸ ä¼šè¯å·²æš‚åœ', 'info');
            } else {
                session.totalPauseTime += performance.now() - session.pauseTime;
                pauseBtn.textContent = 'æš‚åœ';
                showLog('â–¶ï¸ ä¼šè¯ç»§ç»­...', 'info');
            }
        }
        
        function stopSession() {
            session.isRunning = false;
            clearInterval(session.timerInterval);
            document.getElementById('controlButtons').classList.add('hidden');
            document.getElementById('startBtn').disabled = false;
            showLog('â¹ï¸ ä¼šè¯å·²åœæ­¢', 'info');
            updateStats();
        }
        
        function completeSession() {
            session.isRunning = false;
            clearInterval(session.timerInterval);
            
            const duration = Math.floor((performance.now() - session.startTime - session.totalPauseTime) / 1000);
            
            showCelebration();
            showLog(`ğŸ‰ ä¼šè¯å®Œæˆï¼`, 'success');
            showLog(`ğŸ“Š æ€»è®¡ ${session.insertions} æ¬¡æ’å…¥ï¼Œç”¨æ—¶ ${formatTime(duration)}`, 'success');
            
            history.push({
                date: new Date().toLocaleString('zh-CN'),
                insertions: session.insertions,
                duration: duration,
                usedLube: config.useLube
            });
            
            saveSessionHistory();
            updateHistoryChart();
            displayHealthReport();
            
            document.getElementById('controlButtons').classList.add('hidden');
            document.getElementById('startBtn').disabled = false;
        }
        
        function displayHealthReport() {
            const html = `
                <div class="health-report">
                    <h3>ğŸ¥ ä¼šè¯åå¥åº·æ£€æŸ¥</h3>
                    
                    <div class="health-item">
                        <strong>è‚›é—¨è§‚å¯Ÿï¼š</strong>
                        ${config.useLube ? 'ä½¿ç”¨äº†æ¶¦æ»‘å‰‚ï¼Œåº”è¯¥è¾ƒä¸ºæ¹¿æ¶¦ã€‚' : 'âš ï¸ æœªä½¿ç”¨æ¶¦æ»‘å‰‚ï¼Œéœ€ä»”ç»†æ£€æŸ¥ã€‚'}
                    </div>
                    
                    <div class="health-item">
                        <strong>å‡ºè¡€æ£€æŸ¥ï¼š</strong>
                        å°‘é‡è¡€ä¸å±äºæ­£å¸¸ã€‚å¦‚å‡ºè¡€é‡è¾ƒå¤šè¯·ç«‹å³åœæ­¢å¹¶å’¨è¯¢åŒ»ç”Ÿã€‚
                    </div>
                    
                    <div class="health-item">
                        <strong>è‚ æ¶²åˆ†æ³Œï¼š</strong>
                        é€‚é‡è‚ æ¶²åˆ†æ³Œæ˜¯æ­£å¸¸çš„ç”Ÿç†ååº”ã€‚
                    </div>
                    
                    <div class="care-tips">
                        <h4>ğŸ’¡ æŠ¤ç†ä¸æ¸…æ´å»ºè®®</h4>
                        <ul>
                            <li>ç”¨æ¸©æ°´è½»æŸ”æ¸…æ´—è‚›é—¨å‘¨å›´</li>
                            <li>é¿å…ä½¿ç”¨åˆºæ¿€æ€§æ¸…æ´å‰‚</li>
                            <li>ç©å…·ä½¿ç”¨åç«‹å³æ¸…æ´—æ¶ˆæ¯’</li>
                            <li>å»ºè®®ä¼‘æ¯24-48å°æ—¶</li>
                            <li>å¦‚æœ‰æŒç»­ç–¼ç—›è¯·å’¨è¯¢åŒ»ç”Ÿ</li>
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('healthReport').innerHTML = html;
            document.getElementById('healthReport').classList.remove('hidden');
        }
        
        function showCelebration() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.textContent = 'ğŸ‰';
            document.body.appendChild(celebration);
            setTimeout(() => celebration.remove(), 1000);
        }
        
        function startTimer() {
            session.timerInterval = setInterval(() => {
                if (!session.isPaused && session.isRunning) {
                    const elapsed = Math.floor((performance.now() - session.startTime - session.totalPauseTime) / 1000);
                    document.getElementById('timer').textContent = formatTime(elapsed);
                }
            }, 1000);
        }
        
        function updateStats() {
            const progressPercent = (session.currentCycle / config.totalCount * 100).toFixed(1);
            document.getElementById('progress').textContent = progressPercent + '%';
            document.getElementById('progressBar').style.width = progressPercent + '%';
            document.getElementById('insertCount').textContent = session.insertions;
            
            const remaining = (config.totalCount - session.currentCycle) * config.actionDelay;
            const mins = Math.floor(remaining / 60);
            const secs = Math.floor(remaining % 60);
            document.getElementById('remaining').textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function updateHistoryChart() {
            const chartContainer = document.getElementById('historyChart');
            chartContainer.innerHTML = '';
            
            if (history.length === 0) return;
            
            const maxInsertions = Math.max(...history.map(h => h.insertions));
            const recentHistory = history.slice(-10);
            
            recentHistory.forEach((h, i) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                const height = (h.insertions / maxInsertions) * 100;
                bar.style.height = height + '%';
                
                if (h.usedLube) {
                    bar.style.background = 'linear-gradient(to top, #48bb78, #38a169)';
                } else {
                    bar.style.background = 'linear-gradient(to top, #fc8181, #f56565)';
                }
                
                bar.title = `${h.date}\n${h.insertions} æ¬¡\n${formatTime(h.duration)}\n${h.usedLube ? 'âœ… æ¶¦æ»‘' : 'âŒ æ— æ¶¦æ»‘'}`;
                chartContainer.appendChild(bar);
            });
        }
        
        function showLog(message, type = 'info') {
            const log = document.getElementById('logContainer');
            const entry = document.createElement('div');
            const icons = {
                insert: 'ğŸ’—',
                withdraw: 'ğŸ’™',
                info: 'â„¹ï¸',
                success: 'âœ…',
                motivation: 'ğŸ’¬'
            };
            
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `
                <span class="log-icon">${icons[type] || 'â„¹ï¸'}</span>
                <span>${new Date().toLocaleTimeString('zh-CN')} - ${message}</span>
            `;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
        }
        
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
