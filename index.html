<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…çº§è®¡æ—¶å™¨ Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><circle cx="12" cy="12" r="8" fill="%2300ff00" opacity="0.6"/><circle cx="12" cy="12" r="3" fill="%23fff"/></svg>'), auto;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            overflow: hidden;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 800px;
            width: 90%;
            transition: transform 0.3s ease;
        }

        .container:hover {
            transform: translateY(-5px);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }
            to { text-shadow: 0 0 20px rgba(255, 255, 255, 0.8); }
        }

        .timer-display {
            font-size: 4em;
            text-align: center;
            margin: 30px 0;
            font-weight: bold;
            letter-spacing: 5px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            font-variant-numeric: tabular-nums;
        }

        .mode-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mode-tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid transparent;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            color: white;
        }

        .mode-tab:hover, .mode-tab.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
            transform: scale(1.05);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-start {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-pause {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-lap {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(-1px);
        }

        .input-section {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        input[type="number"] {
            width: 80px;
            padding: 10px;
            font-size: 1.2em;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            text-align: center;
        }

        input[type="number"]::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .laps {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 15px;
        }

        .lap-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .gamepad-status {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        .presets {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 8px 16px;
            font-size: 0.9em;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            min-width: 120px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 5px;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>â±ï¸ è¶…çº§è®¡æ—¶å™¨ Pro</h1>
        
        <div class="mode-tabs">
            <div class="mode-tab active" data-mode="stopwatch">â±ï¸ ç§’è¡¨</div>
            <div class="mode-tab" data-mode="countdown">â²ï¸ å€’è®¡æ—¶</div>
            <div class="mode-tab" data-mode="pomodoro">ğŸ… ç•ªèŒ„é’Ÿ</div>
            <div class="mode-tab" data-mode="interval">âš¡ é—´éš”è®­ç»ƒ</div>
        </div>

        <div class="timer-display" id="display">00:00:00.00</div>

        <div class="progress-bar" id="progressBar" style="display:none;">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="input-section" id="inputSection" style="display:none;">
            <input type="number" id="hours" placeholder="æ—¶" min="0" max="23">
            <input type="number" id="minutes" placeholder="åˆ†" min="0" max="59">
            <input type="number" id="seconds" placeholder="ç§’" min="0" max="59">
        </div>

        <div class="presets" id="presets" style="display:none;">
            <button class="preset-btn" data-time="300">5åˆ†é’Ÿ</button>
            <button class="preset-btn" data-time="600">10åˆ†é’Ÿ</button>
            <button class="preset-btn" data-time="900">15åˆ†é’Ÿ</button>
            <button class="preset-btn" data-time="1800">30åˆ†é’Ÿ</button>
            <button class="preset-btn" data-time="3600">1å°æ—¶</button>
        </div>

        <div class="controls">
            <button class="btn-start" id="startBtn">å¼€å§‹</button>
            <button class="btn-pause" id="pauseBtn">æš‚åœ</button>
            <button class="btn-reset" id="resetBtn">é‡ç½®</button>
            <button class="btn-lap" id="lapBtn">è®¡æ¬¡</button>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div>æ€»ä¼šè¯</div>
                <div class="stat-value" id="totalSessions">0</div>
            </div>
            <div class="stat-item">
                <div>ä»Šæ—¥ä½¿ç”¨</div>
                <div class="stat-value" id="todayTime">0åˆ†é’Ÿ</div>
            </div>
            <div class="stat-item">
                <div>æœ€é•¿è®°å½•</div>
                <div class="stat-value" id="longestTime">0åˆ†é’Ÿ</div>
            </div>
        </div>

        <div class="laps" id="laps" style="display:none;"></div>

        <div class="gamepad-status" id="gamepadStatus">
            ğŸ® æ”¯æŒæ‰‹æŸ„æ“ä½œ: Aé”®-å¼€å§‹/æš‚åœ | Bé”®-é‡ç½® | Xé”®-è®¡æ¬¡ | åå­—é”®-åˆ‡æ¢æ¨¡å¼
        </div>
    </div>

    <script>
        class SuperTimer {
            constructor() {
                this.mode = 'stopwatch';
                this.isRunning = false;
                this.isPaused = false;
                this.startTime = 0;
                this.elapsedTime = 0;
                this.pausedTime = 0;
                this.countdownTotal = 0;
                this.laps = [];
                this.lapCount = 0;
                this.interval = null;
                this.gamepadIndex = null;
                this.lastButtonStates = {};
                
                this.initElements();
                this.initEventListeners();
                this.loadFromStorage();
                this.initGamepad();
                this.updateStats();
            }

            initElements() {
                this.display = document.getElementById('display');
                this.startBtn = document.getElementById('startBtn');
                this.pauseBtn = document.getElementById('pauseBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.lapBtn = document.getElementById('lapBtn');
                this.lapsContainer = document.getElementById('laps');
                this.inputSection = document.getElementById('inputSection');
                this.presets = document.getElementById('presets');
                this.progressBar = document.getElementById('progressBar');
                this.progressFill = document.getElementById('progressFill');
                this.modeTabs = document.querySelectorAll('.mode-tab');
            }

            initEventListeners() {
                this.startBtn.addEventListener('click', () => this.start());
                this.pauseBtn.addEventListener('click', () => this.pause());
                this.resetBtn.addEventListener('click', () => this.reset());
                this.lapBtn.addEventListener('click', () => this.recordLap());

                this.modeTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        this.modeTabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.mode = tab.dataset.mode;
                        this.switchMode(this.mode);
                    });
                });

                document.querySelectorAll('.preset-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const time = parseInt(btn.dataset.time);
                        this.setCountdown(time);
                    });
                });
            }

            switchMode(mode) {
                this.reset();
                this.inputSection.style.display = 'none';
                this.presets.style.display = 'none';
                this.progressBar.style.display = 'none';

                if (mode === 'countdown') {
                    this.inputSection.style.display = 'flex';
                    this.presets.style.display = 'flex';
                    this.progressBar.style.display = 'block';
                } else if (mode === 'pomodoro') {
                    this.setCountdown(25 * 60);
                    this.progressBar.style.display = 'block';
                } else if (mode === 'interval') {
                    this.progressBar.style.display = 'block';
                }
            }

            start() {
                if (this.isRunning) return;

                if (this.mode === 'countdown' && !this.countdownTotal && !this.isPaused) {
                    const hours = parseInt(document.getElementById('hours').value) || 0;
                    const minutes = parseInt(document.getElementById('minutes').value) || 0;
                    const seconds = parseInt(document.getElementById('seconds').value) || 0;
                    this.countdownTotal = hours * 3600 + minutes * 60 + seconds;
                    if (this.countdownTotal === 0) return;
                    this.elapsedTime = this.countdownTotal * 1000;
                }

                this.isRunning = true;
                this.isPaused = false;
                this.startTime = Date.now() - (this.pausedTime || 0);
                
                this.saveToStorage();
                this.updateDisplay();
                
                this.interval = setInterval(() => {
                    this.updateDisplay();
                    this.saveToStorage();
                }, 10);

                this.startBtn.textContent = 'è¿è¡Œä¸­...';
            }

            pause() {
                if (!this.isRunning) return;
                
                this.isRunning = false;
                this.isPaused = true;
                clearInterval(this.interval);
                this.pausedTime = Date.now() - this.startTime;
                this.saveToStorage();
                this.startBtn.textContent = 'ç»§ç»­';
            }

            reset() {
                this.isRunning = false;
                this.isPaused = false;
                clearInterval(this.interval);
                this.startTime = 0;
                this.elapsedTime = 0;
                this.pausedTime = 0;
                this.countdownTotal = 0;
                this.laps = [];
                this.lapCount = 0;
                this.lapsContainer.innerHTML = '';
                this.lapsContainer.style.display = 'none';
                this.display.textContent = '00:00:00.00';
                this.progressFill.style.width = '0%';
                this.startBtn.textContent = 'å¼€å§‹';
                
                localStorage.removeItem('timer-state');
                
                document.getElementById('hours').value = '';
                document.getElementById('minutes').value = '';
                document.getElementById('seconds').value = '';
            }

            updateDisplay() {
                let currentTime;
                
                if (this.mode === 'stopwatch') {
                    currentTime = Date.now() - this.startTime;
                    this.display.textContent = this.formatTime(currentTime);
                } else if (this.mode === 'countdown' || this.mode === 'pomodoro') {
                    const elapsed = Date.now() - this.startTime;
                    currentTime = this.elapsedTime - elapsed;
                    
                    if (currentTime <= 0) {
                        currentTime = 0;
                        this.pause();
                        this.playSound();
                        alert('æ—¶é—´åˆ°ï¼');
                        this.updateSessionStats(this.countdownTotal);
                    }
                    
                    this.display.textContent = this.formatTime(currentTime);
                    const progress = ((this.elapsedTime - currentTime) / this.elapsedTime) * 100;
                    this.progressFill.style.width = progress + '%';
                }
            }

            formatTime(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                const milliseconds = Math.floor((ms % 1000) / 10);

                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(2, '0')}`;
            }

            recordLap() {
                if (!this.isRunning && !this.isPaused) return;
                
                this.lapCount++;
                const currentTime = this.display.textContent;
                const lapElement = document.createElement('div');
                lapElement.className = 'lap-item';
                lapElement.innerHTML = `<span>è®¡æ¬¡ ${this.lapCount}</span><span>${currentTime}</span>`;
                this.lapsContainer.insertBefore(lapElement, this.lapsContainer.firstChild);
                this.lapsContainer.style.display = 'block';
                this.laps.push(currentTime);
            }

            setCountdown(seconds) {
                this.countdownTotal = seconds;
                this.elapsedTime = seconds * 1000;
                this.display.textContent = this.formatTime(this.elapsedTime);
            }

            saveToStorage() {
                const state = {
                    mode: this.mode,
                    isRunning: this.isRunning,
                    isPaused: this.isPaused,
                    startTime: this.startTime,
                    elapsedTime: this.elapsedTime,
                    pausedTime: this.pausedTime,
                    countdownTotal: this.countdownTotal,
                    savedAt: Date.now()
                };
                localStorage.setItem('timer-state', JSON.stringify(state));
            }

            loadFromStorage() {
                const saved = localStorage.getItem('timer-state');
                if (!saved) return;

                const state = JSON.parse(saved);
                const timeSinceLastSave = Date.now() - state.savedAt;

                this.mode = state.mode;
                this.countdownTotal = state.countdownTotal;
                this.elapsedTime = state.elapsedTime;

                if (state.isRunning) {
                    this.startTime = state.startTime + timeSinceLastSave;
                    this.start();
                } else if (state.isPaused) {
                    this.pausedTime = state.pausedTime;
                    this.isPaused = true;
                    this.startTime = Date.now() - this.pausedTime;
                    this.updateDisplay();
                }

                this.modeTabs.forEach(tab => {
                    if (tab.dataset.mode === this.mode) {
                        this.modeTabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.switchMode(this.mode);
                    }
                });
            }

            initGamepad() {
                window.addEventListener('gamepadconnected', (e) => {
                    this.gamepadIndex = e.gamepad.index;
                    document.getElementById('gamepadStatus').textContent = `ğŸ® æ‰‹æŸ„å·²è¿æ¥: ${e.gamepad.id}`;
                });

                window.addEventListener('gamepaddisconnected', () => {
                    this.gamepadIndex = null;
                    document.getElementById('gamepadStatus').textContent = 'ğŸ® æ‰‹æŸ„å·²æ–­å¼€';
                });

                setInterval(() => this.pollGamepad(), 100);
            }

            pollGamepad() {
                if (this.gamepadIndex === null) return;

                const gamepad = navigator.getGamepads()[this.gamepadIndex];
                if (!gamepad) return;

                // AæŒ‰é’® (æŒ‰é’®0) - å¼€å§‹/æš‚åœ
                if (this.isButtonPressed(gamepad, 0)) {
                    if (this.isRunning) this.pause();
                    else this.start();
                }

                // BæŒ‰é’® (æŒ‰é’®1) - é‡ç½®
                if (this.isButtonPressed(gamepad, 1)) {
                    this.reset();
                }

                // XæŒ‰é’® (æŒ‰é’®2) - è®¡æ¬¡
                if (this.isButtonPressed(gamepad, 2)) {
                    this.recordLap();
                }

                // åå­—é”®åˆ‡æ¢æ¨¡å¼
                if (this.isButtonPressed(gamepad, 12)) { // ä¸Š
                    this.switchToMode(0);
                }
                if (this.isButtonPressed(gamepad, 14)) { // å·¦
                    this.switchToMode(1);
                }
                if (this.isButtonPressed(gamepad, 15)) { // å³
                    this.switchToMode(2);
                }
                if (this.isButtonPressed(gamepad, 13)) { // ä¸‹
                    this.switchToMode(3);
                }
            }

            isButtonPressed(gamepad, buttonIndex) {
                const currentState = gamepad.buttons[buttonIndex]?.pressed;
                const lastState = this.lastButtonStates[buttonIndex];
                this.lastButtonStates[buttonIndex] = currentState;
                return currentState && !lastState;
            }

            switchToMode(index) {
                const tabs = Array.from(this.modeTabs);
                if (tabs[index]) {
                    tabs[index].click();
                }
            }

            playSound() {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            }

            updateSessionStats(duration) {
                const stats = JSON.parse(localStorage.getItem('timer-stats') || '{}');
                stats.totalSessions = (stats.totalSessions || 0) + 1;
                stats.totalTime = (stats.totalTime || 0) + duration;
                stats.longestSession = Math.max(stats.longestSession || 0, duration);
                
                const today = new Date().toDateString();
                if (!stats.dailyTime) stats.dailyTime = {};
                stats.dailyTime[today] = (stats.dailyTime[today] || 0) + duration;
                
                localStorage.setItem('timer-stats', JSON.stringify(stats));
                this.updateStats();
            }

            updateStats() {
                const stats = JSON.parse(localStorage.getItem('timer-stats') || '{}');
                const today = new Date().toDateString();
                
                document.getElementById('totalSessions').textContent = stats.totalSessions || 0;
                document.getElementById('todayTime').textContent = Math.floor((stats.dailyTime?.[today] || 0) / 60) + 'åˆ†é’Ÿ';
                document.getElementById('longestTime').textContent = Math.floor((stats.longestSession || 0) / 60) + 'åˆ†é’Ÿ';
            }
        }

        // åˆå§‹åŒ–è®¡æ—¶å™¨
        const timer = new SuperTimer();
    </script>
</body>
</html>
