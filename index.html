<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë∂ÖÁ∫ßËÆ°Êó∂Âô® Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            overflow-x: hidden;
            cursor: default;
        }

        body.gamepad-active {
            cursor: none;
        }

        .container {
            background: rgba(16, 185, 129, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(16, 185, 129, 0.3);
            border: 2px solid rgba(16, 185, 129, 0.3);
            max-width: 800px;
            width: 90%;
            transition: transform 0.3s ease;
            margin: 50px 0;
        }

        .container:hover {
            transform: translateY(-5px);
            border-color: rgba(16, 185, 129, 0.5);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.8);
            animation: glow 2s ease-in-out infinite alternate;
            color: #10b981;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(16, 185, 129, 0.5); }
            to { text-shadow: 0 0 25px rgba(16, 185, 129, 1); }
        }

        .timer-display {
            font-size: 4em;
            text-align: center;
            margin: 30px 0;
            font-weight: bold;
            letter-spacing: 5px;
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.8);
            font-variant-numeric: tabular-nums;
            color: #34d399;
        }

        .mode-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mode-tab {
            padding: 12px 24px;
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid transparent;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            color: #d1fae5;
        }

        .mode-tab:hover {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }

        .mode-tab.active {
            background: rgba(16, 185, 129, 0.4);
            border-color: #10b981;
            color: white;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-start {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-pause {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-reset {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        .btn-lap {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            color: white;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        button:active {
            transform: translateY(-1px);
        }

        .input-section {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        input[type="number"] {
            width: 80px;
            padding: 10px;
            font-size: 1.2em;
            border-radius: 10px;
            border: 2px solid rgba(16, 185, 129, 0.3);
            background: rgba(16, 185, 129, 0.1);
            color: white;
            text-align: center;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }

        input[type="number"]::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .laps {
            max-height: 250px;
            overflow-y: auto;
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .lap-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(16, 185, 129, 0.15);
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            animation: slideIn 0.3s ease;
            border-left: 3px solid #10b981;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            transition: width 0.3s ease;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.8);
        }

        .presets {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 8px 16px;
            font-size: 0.9em;
            background: rgba(16, 185, 129, 0.2);
            color: #d1fae5;
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .preset-btn:hover {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-item {
            background: rgba(16, 185, 129, 0.15);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            min-width: 120px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 5px;
            color: #34d399;
        }

        /* ËôöÊãüÂÖâÊ†áÊ†∑Âºè */
        .virtual-cursor {
            position: fixed;
            width: 24px;
            height: 24px;
            pointer-events: none;
            z-index: 10000;
            display: none;
            filter: drop-shadow(0 0 5px rgba(16, 185, 129, 0.8));
        }

        .virtual-cursor.active {
            display: block;
        }

        .cursor-arrow {
            width: 0;
            height: 0;
            border-left: 12px solid #10b981;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            transform: rotate(-45deg);
            position: relative;
        }

        .cursor-arrow::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            top: 50%;
            left: -3px;
            transform: translateY(-50%);
        }

        /* Toast ÈÄöÁü• */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: rgba(16, 185, 129, 0.95);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5);
            border: 1px solid #10b981;
            opacity: 0;
            transform: translateX(400px);
            transition: all 0.3s ease;
            min-width: 250px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.error {
            background: rgba(239, 68, 68, 0.95);
            border-color: #ef4444;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(16, 185, 129, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(16, 185, 129, 0.4);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(16, 185, 129, 0.6);
        }

        .custom-time-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .custom-time-input {
            display: flex;
            justify-content: center;
            gap: 10px;
            align-items: center;
        }

        label {
            color: #d1fae5;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="virtual-cursor" id="virtualCursor">
        <div class="cursor-arrow"></div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        <h1>‚è±Ô∏è Ë∂ÖÁ∫ßËÆ°Êó∂Âô® Pro</h1>
        
        <div class="mode-tabs">
            <div class="mode-tab active" data-mode="stopwatch">‚è±Ô∏è ÁßíË°®</div>
            <div class="mode-tab" data-mode="countdown">‚è≤Ô∏è ÂÄíËÆ°Êó∂</div>
            <div class="mode-tab" data-mode="pomodoro">üçÖ Áï™ËåÑÈíü</div>
            <div class="mode-tab" data-mode="interval">‚ö° Èó¥ÈöîËÆ≠ÁªÉ</div>
        </div>

        <div class="timer-display" id="display">00:00:00.00</div>

        <div class="progress-bar" id="progressBar" style="display:none;">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="custom-time-section" id="customTimeSection" style="display:none;">
            <div class="custom-time-input">
                <label>Ëá™ÂÆö‰πâÊó∂Èó¥:</label>
            </div>
            <div class="input-section">
                <input type="number" id="hours" placeholder="Êó∂" min="0" max="23">
                <input type="number" id="minutes" placeholder="ÂàÜ" min="0" max="59">
                <input type="number" id="seconds" placeholder="Áßí" min="0" max="59">
            </div>
        </div>

        <div class="presets" id="presets" style="display:none;">
            <button class="preset-btn" data-time="60">1ÂàÜÈíü</button>
            <button class="preset-btn" data-time="180">3ÂàÜÈíü</button>
            <button class="preset-btn" data-time="300">5ÂàÜÈíü</button>
            <button class="preset-btn" data-time="600">10ÂàÜÈíü</button>
            <button class="preset-btn" data-time="900">15ÂàÜÈíü</button>
            <button class="preset-btn" data-time="1800">30ÂàÜÈíü</button>
            <button class="preset-btn" data-time="3600">1Â∞èÊó∂</button>
        </div>

        <div class="controls">
            <button class="btn-start" id="startBtn">ÂºÄÂßã</button>
            <button class="btn-pause" id="pauseBtn">ÊöÇÂÅú</button>
            <button class="btn-reset" id="resetBtn">ÈáçÁΩÆ</button>
            <button class="btn-lap" id="lapBtn">ËÆ°Ê¨°</button>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div>ÊÄª‰ºöËØù</div>
                <div class="stat-value" id="totalSessions">0</div>
            </div>
            <div class="stat-item">
                <div>‰ªäÊó•‰ΩøÁî®</div>
                <div class="stat-value" id="todayTime">0ÂàÜÈíü</div>
            </div>
            <div class="stat-item">
                <div>ÊúÄÈïøËÆ∞ÂΩï</div>
                <div class="stat-value" id="longestTime">0ÂàÜÈíü</div>
            </div>
        </div>

        <div class="laps" id="laps" style="display:none;"></div>
    </div>

    <script>
        class SuperTimer {
            constructor() {
                this.mode = 'stopwatch';
                this.isRunning = false;
                this.isPaused = false;
                this.startTime = 0;
                this.elapsedTime = 0;
                this.pausedTime = 0;
                this.countdownTotal = 0;
                this.laps = [];
                this.lapCount = 0;
                this.interval = null;
                
                // ÊâãÊüÑÁõ∏ÂÖ≥
                this.gamepadIndex = null;
                this.lastButtonStates = {};
                this.cursorX = window.innerWidth / 2;
                this.cursorY = window.innerHeight / 2;
                this.cursorSpeed = 8;
                this.scrollSpeed = 10;
                
                this.initElements();
                this.initEventListeners();
                this.loadFromStorage();
                this.initGamepad();
                this.updateStats();
            }

            initElements() {
                this.display = document.getElementById('display');
                this.startBtn = document.getElementById('startBtn');
                this.pauseBtn = document.getElementById('pauseBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.lapBtn = document.getElementById('lapBtn');
                this.lapsContainer = document.getElementById('laps');
                this.customTimeSection = document.getElementById('customTimeSection');
                this.presets = document.getElementById('presets');
                this.progressBar = document.getElementById('progressBar');
                this.progressFill = document.getElementById('progressFill');
                this.modeTabs = document.querySelectorAll('.mode-tab');
                this.virtualCursor = document.getElementById('virtualCursor');
            }

            initEventListeners() {
                this.startBtn.addEventListener('click', () => this.start());
                this.pauseBtn.addEventListener('click', () => this.pause());
                this.resetBtn.addEventListener('click', () => this.reset());
                this.lapBtn.addEventListener('click', () => this.recordLap());

                this.modeTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        this.modeTabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.mode = tab.dataset.mode;
                        this.switchMode(this.mode);
                    });
                });

                document.querySelectorAll('.preset-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const time = parseInt(btn.dataset.time);
                        this.setCountdown(time);
                    });
                });

                // ÈîÆÁõòÂø´Êç∑ÈîÆ
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        if (this.isRunning) this.pause();
                        else this.start();
                    } else if (e.code === 'KeyR') {
                        this.reset();
                    } else if (e.code === 'KeyL') {
                        this.recordLap();
                    }
                });
            }

            switchMode(mode) {
                this.reset();
                this.customTimeSection.style.display = 'none';
                this.presets.style.display = 'none';
                this.progressBar.style.display = 'none';

                if (mode === 'countdown') {
                    this.customTimeSection.style.display = 'block';
                    this.presets.style.display = 'flex';
                    this.progressBar.style.display = 'block';
                } else if (mode === 'pomodoro') {
                    this.setCountdown(25 * 60);
                    this.progressBar.style.display = 'block';
                } else if (mode === 'interval') {
                    this.progressBar.style.display = 'block';
                    this.setCountdown(30);
                }
            }

            start() {
                if (this.isRunning) return;

                if (this.mode === 'countdown' && !this.countdownTotal && !this.isPaused) {
                    const hours = parseInt(document.getElementById('hours').value) || 0;
                    const minutes = parseInt(document.getElementById('minutes').value) || 0;
                    const seconds = parseInt(document.getElementById('seconds').value) || 0;
                    this.countdownTotal = hours * 3600 + minutes * 60 + seconds;
                    if (this.countdownTotal === 0) {
                        this.showToast('ËØ∑ËÆæÁΩÆÂÄíËÆ°Êó∂Êó∂Èó¥', 'error');
                        return;
                    }
                    this.elapsedTime = this.countdownTotal * 1000;
                }

                this.isRunning = true;
                this.isPaused = false;
                this.startTime = Date.now() - (this.pausedTime || 0);
                
                this.saveToStorage();
                this.updateDisplay();
                
                this.interval = setInterval(() => {
                    this.updateDisplay();
                    this.saveToStorage();
                }, 10);

                this.startBtn.textContent = 'ËøêË°å‰∏≠...';
            }

            pause() {
                if (!this.isRunning) return;
                
                this.isRunning = false;
                this.isPaused = true;
                clearInterval(this.interval);
                this.pausedTime = Date.now() - this.startTime;
                this.saveToStorage();
                this.startBtn.textContent = 'ÁªßÁª≠';
            }

            reset() {
                this.isRunning = false;
                this.isPaused = false;
                clearInterval(this.interval);
                this.startTime = 0;
                this.elapsedTime = 0;
                this.pausedTime = 0;
                this.countdownTotal = 0;
                this.laps = [];
                this.lapCount = 0;
                this.lapsContainer.innerHTML = '';
                this.lapsContainer.style.display = 'none';
                this.display.textContent = '00:00:00.00';
                this.progressFill.style.width = '0%';
                this.startBtn.textContent = 'ÂºÄÂßã';
                
                localStorage.removeItem('timer-state');
                
                document.getElementById('hours').value = '';
                document.getElementById('minutes').value = '';
                document.getElementById('seconds').value = '';
            }

            updateDisplay() {
                let currentTime;
                
                if (this.mode === 'stopwatch') {
                    currentTime = Date.now() - this.startTime;
                    this.display.textContent = this.formatTime(currentTime);
                } else if (this.mode === 'countdown' || this.mode === 'pomodoro' || this.mode === 'interval') {
                    const elapsed = Date.now() - this.startTime;
                    currentTime = this.elapsedTime - elapsed;
                    
                    if (currentTime <= 0) {
                        currentTime = 0;
                        this.pause();
                        this.playSound();
                        this.showToast('‚è∞ Êó∂Èó¥Âà∞ÔºÅ');
                        this.updateSessionStats(this.countdownTotal);
                    }
                    
                    this.display.textContent = this.formatTime(currentTime);
                    const progress = ((this.elapsedTime - currentTime) / this.elapsedTime) * 100;
                    this.progressFill.style.width = progress + '%';
                }
            }

            formatTime(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                const milliseconds = Math.floor((ms % 1000) / 10);

                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(2, '0')}`;
            }

            recordLap() {
                if (!this.isRunning && !this.isPaused) return;
                
                this.lapCount++;
                const currentTime = this.display.textContent;
                const lapElement = document.createElement('div');
                lapElement.className = 'lap-item';
                lapElement.innerHTML = `<span>ËÆ°Ê¨° ${this.lapCount}</span><span>${currentTime}</span>`;
                this.lapsContainer.insertBefore(lapElement, this.lapsContainer.firstChild);
                this.lapsContainer.style.display = 'block';
                this.laps.push(currentTime);
            }

            setCountdown(seconds) {
                this.countdownTotal = seconds;
                this.elapsedTime = seconds * 1000;
                this.display.textContent = this.formatTime(this.elapsedTime);
            }

            saveToStorage() {
                const state = {
                    mode: this.mode,
                    isRunning: this.isRunning,
                    isPaused: this.isPaused,
                    startTime: this.startTime,
                    elapsedTime: this.elapsedTime,
                    pausedTime: this.pausedTime,
                    countdownTotal: this.countdownTotal,
                    savedAt: Date.now()
                };
                localStorage.setItem('timer-state', JSON.stringify(state));
            }

            loadFromStorage() {
                const saved = localStorage.getItem('timer-state');
                if (!saved) return;

                const state = JSON.parse(saved);
                const timeSinceLastSave = Date.now() - state.savedAt;

                this.mode = state.mode;
                this.countdownTotal = state.countdownTotal;
                this.elapsedTime = state.elapsedTime;

                if (state.isRunning) {
                    this.startTime = state.startTime + timeSinceLastSave;
                    this.start();
                } else if (state.isPaused) {
                    this.pausedTime = state.pausedTime;
                    this.isPaused = true;
                    this.startTime = Date.now() - this.pausedTime;
                    this.updateDisplay();
                }

                this.modeTabs.forEach(tab => {
                    if (tab.dataset.mode === this.mode) {
                        this.modeTabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.switchMode(this.mode);
                    }
                });
            }

            initGamepad() {
                window.addEventListener('gamepadconnected', (e) => {
                    this.gamepadIndex = e.gamepad.index;
                    this.showToast(`üéÆ ÊâãÊüÑÂ∑≤ËøûÊé•: ${e.gamepad.id.substring(0, 30)}...`);
                    this.virtualCursor.classList.add('active');
                    document.body.classList.add('gamepad-active');
                });

                window.addEventListener('gamepaddisconnected', () => {
                    this.gamepadIndex = null;
                    this.showToast('üéÆ ÊâãÊüÑÂ∑≤Êñ≠ÂºÄ', 'error');
                    this.virtualCursor.classList.remove('active');
                    document.body.classList.remove('gamepad-active');
                });

                setInterval(() => this.pollGamepad(), 16);
            }

            pollGamepad() {
                if (this.gamepadIndex === null) return;

                const gamepad = navigator.getGamepads()[this.gamepadIndex];
                if (!gamepad) return;

                // Â∑¶ÊëáÊùÜÊéßÂà∂ÂÖâÊ†á (axes 0, 1)
                const leftStickX = Math.abs(gamepad.axes[0]) > 0.1 ? gamepad.axes[0] : 0;
                const leftStickY = Math.abs(gamepad.axes[1]) > 0.1 ? gamepad.axes[1] : 0;

                if (leftStickX !== 0 || leftStickY !== 0) {
                    this.cursorX += leftStickX * this.cursorSpeed;
                    this.cursorY += leftStickY * this.cursorSpeed;

                    this.cursorX = Math.max(0, Math.min(window.innerWidth, this.cursorX));
                    this.cursorY = Math.max(0, Math.min(window.innerHeight, this.cursorY));

                    this.virtualCursor.style.left = this.cursorX + 'px';
                    this.virtualCursor.style.top = this.cursorY + 'px';
                }

                // Âè≥ÊëáÊùÜÊéßÂà∂ÊªöÂä® (axes 2, 3)
                const rightStickY = Math.abs(gamepad.axes[3]) > 0.2 ? gamepad.axes[3] : 0;
                if (rightStickY !== 0) {
                    window.scrollBy(0, rightStickY * this.scrollSpeed);
                }

                // AÊåâÈíÆ (ÊåâÈíÆ0) - Á°ÆËÆ§/ÁÇπÂáª
                if (this.isButtonPressed(gamepad, 0)) {
                    this.clickAtCursor();
                }

                // BÊåâÈíÆ (ÊåâÈíÆ1) - ÈáçÁΩÆ
                if (this.isButtonPressed(gamepad, 1)) {
                    this.reset();
                }

                // XÊåâÈíÆ (ÊåâÈíÆ2) - ËÆ°Ê¨°
                if (this.isButtonPressed(gamepad, 2)) {
                    this.recordLap();
                }

                // YÊåâÈíÆ (ÊåâÈíÆ3) - ÂºÄÂßã/ÊöÇÂÅú
                if (this.isButtonPressed(gamepad, 3)) {
                    if (this.isRunning) this.pause();
                    else this.start();
                }

                // LB (ÊåâÈíÆ4) - ‰∏ä‰∏Ä‰∏™Ê®°Âºè
                if (this.isButtonPressed(gamepad, 4)) {
                    this.switchToPreviousMode();
                }

                // RB (ÊåâÈíÆ5) - ‰∏ã‰∏Ä‰∏™Ê®°Âºè
                if (this.isButtonPressed(gamepad, 5)) {
                    this.switchToNextMode();
                }
            }

            isButtonPressed(gamepad, buttonIndex) {
                const currentState = gamepad.buttons[buttonIndex]?.pressed;
                const lastState = this.lastButtonStates[buttonIndex];
                this.lastButtonStates[buttonIndex] = currentState;
                return currentState && !lastState;
            }

            clickAtCursor() {
                const element = document.elementFromPoint(this.cursorX, this.cursorY);
                if (element && (element.tagName === 'BUTTON' || element.classList.contains('mode-tab') || element.classList.contains('preset-btn'))) {
                    element.click();
                    // ËßÜËßâÂèçÈ¶à
                    element.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        element.style.transform = '';
                    }, 100);
                }
            }

            switchToPreviousMode() {
                const tabs = Array.from(this.modeTabs);
                const currentIndex = tabs.findIndex(tab => tab.classList.contains('active'));
                const prevIndex = (currentIndex - 1 + tabs.length) % tabs.length;
                tabs[prevIndex].click();
            }

            switchToNextMode() {
                const tabs = Array.from(this.modeTabs);
                const currentIndex = tabs.findIndex(tab => tab.classList.contains('active'));
                const nextIndex = (currentIndex + 1) % tabs.length;
                tabs[nextIndex].click();
            }

            playSound() {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            }

            showToast(message, type = 'success') {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                
                toastContainer.appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        toastContainer.removeChild(toast);
                    }, 300);
                }, 3000);
            }

            updateSessionStats(duration) {
                const stats = JSON.parse(localStorage.getItem('timer-stats') || '{}');
                stats.totalSessions = (stats.totalSessions || 0) + 1;
                stats.totalTime = (stats.totalTime || 0) + duration;
                stats.longestSession = Math.max(stats.longestSession || 0, duration);
                
                const today = new Date().toDateString();
                if (!stats.dailyTime) stats.dailyTime = {};
                stats.dailyTime[today] = (stats.dailyTime[today] || 0) + duration;
                
                localStorage.setItem('timer-stats', JSON.stringify(stats));
                this.updateStats();
            }

            updateStats() {
                const stats = JSON.parse(localStorage.getItem('timer-stats') || '{}');
                const today = new Date().toDateString();
                
                document.getElementById('totalSessions').textContent = stats.totalSessions || 0;
                document.getElementById('todayTime').textContent = Math.floor((stats.dailyTime?.[today] || 0) / 60) + 'ÂàÜÈíü';
                document.getElementById('longestTime').textContent = Math.floor((stats.longestSession || 0) / 60) + 'ÂàÜÈíü';
            }
        }

        // ÂàùÂßãÂåñËÆ°Êó∂Âô®
        const timer = new SuperTimer();
    </script>
</body>
</html>
