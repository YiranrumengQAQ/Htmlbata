<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è“ç‰™èŠå¤© - Bluetooth Chat</title>
  <style>
    body {background: #17212b; color: #fff; margin: 0; font-family: 'Segoe UI',Roboto,Arial,sans-serif;}
    .header {background: #1c92d2; display:flex; align-items:center; justify-content:space-between; padding:14px;}
    .avatar {width:40px; height:40px; border-radius:50%; background:linear-gradient(135deg,#1c92d2,#2a5298); display:flex;align-items:center;justify-content:center;font-size:20px;}
    .status {font-size:13px;color:#abdfff;}
    .status.connected {color: #4caf50;}
    .btn {background: #0088cc; color: #fff; border:none; padding:8px 20px; border-radius:18px; font-size:15px; cursor:pointer;}
    .chat-fake {flex:1; display:flex;flex-direction:column;overflow-y:auto;padding:12px;}
    .msg {max-width:74%;margin:8px 0;padding:10px;border-radius:14px;position:relative;}
    .out {align-self:flex-end;background:#2b5278;}
    .in {align-self:flex-start;background:#182533;}
    .time {font-size:11px;color:#8b98a5;margin-top:4px;text-align:right;}
    .input-wrap {background: #25364a; padding:7px; display:flex; align-items:center;}
    input {flex:1; border:none; background:#1e2a39; color:#fff; font-size:15px; padding:8px 14px; border-radius:20px;}
    input:disabled {background:#474c52}
    .send-btn {width:36px; height:36px; border-radius:50%; background:#0088cc; border:none; color:white; cursor:pointer; margin-left:10px; font-size:18px;}
    .send-btn:disabled {background:#577585}
  </style>
</head>
<body>
<div class="header">
  <div style="display:flex;align-items:center;gap:12px;">
    <div class="avatar">ğŸ’¬</div>
    <div>
      <div>è“ç‰™èŠå¤©</div>
      <div class="status" id="status">æœªè¿æ¥</div>
    </div>
  </div>
  <button class="btn" id="connectBtn">è¿æ¥è®¾å¤‡</button>
</div>

<div class="chat-fake" id="chatArea">
  <div style="color:#8b98a5;text-align:center;margin-top:40px;">
    <div style="font-size:28px;margin-bottom:12px;">æ¬¢è¿ä½¿ç”¨è“ç‰™èŠå¤©</div>
    <div style="margin-bottom:16px;">ä»…æ”¯æŒéƒ¨åˆ†PEæµè§ˆå™¨ï¼ˆå¦‚Chrome/Edge/Operaç§»åŠ¨ç‰ˆï¼‰ï¼ŒPCç«¯æ— æ³•ä½¿ç”¨</div>
    <div>ç‚¹â€œè¿æ¥è®¾å¤‡â€åæœç´¢å¹¶è¿æ¥å¦ä¸€å°æ‰‹æœºï¼Œå³å¯äº’èŠ</div>
  </div>
</div>
<div class="input-wrap">
  <input type="text" id="msgInput" placeholder="è¾“å…¥æ¶ˆæ¯..." disabled/>
  <button class="send-btn" id="sendBtn" disabled>â¤</button>
</div>
<script>
const SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
const CHARACTERISTIC_UUID = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';

let device, charac, connected=false;

function setStatus(text, ok) {
  document.getElementById('status').textContent = text;
  document.getElementById('status').className = 'status' + (ok ? " connected" : "");
}
function addMsg(text, type) {
  const div = document.createElement('div');
  div.className = 'msg ' + type;
  div.innerHTML = `<div>${text.replace(/</g,'&lt;')}</div><div class="time">${new Date().toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'})}</div>`;
  document.getElementById('chatArea').appendChild(div);
  document.getElementById('chatArea').scrollTop = 99999;
}

async function connectAndChat() {
  if(!navigator.bluetooth) {
    setStatus('âŒ æµè§ˆå™¨ä¸æ”¯æŒè“ç‰™', 0);
    return;
  }
  setStatus('æ­£åœ¨æœç´¢...', 0);
  try {
    device = await navigator.bluetooth.requestDevice({
      filters: [{services:[SERVICE_UUID]}], optionalServices:[SERVICE_UUID]
    });
    setStatus('è¿æ¥ä¸­...', 0);
    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(SERVICE_UUID);
    charac = await service.getCharacteristic(CHARACTERISTIC_UUID);
    await charac.startNotifications();
    charac.addEventListener('characteristicvaluechanged', e => {
      const decoder = new TextDecoder();
      addMsg(decoder.decode(e.target.value), 'in');
    });
    connected = true;
    setStatus('å·²è¿æ¥: '+(device.name||'è®¾å¤‡'), 1);
    document.getElementById('msgInput').disabled = false;
    document.getElementById('sendBtn').disabled = false;
    addMsg('å·²è¿æ¥è®¾å¤‡ï¼Œå¯å¼€å§‹èŠå¤©ã€‚', 'in');
  } catch(e) {
    setStatus('è¿æ¥å¤±è´¥æˆ–å–æ¶ˆ', 0);
    addMsg('âŒ è¿æ¥å¤±è´¥: ' + e.message, 'in');
  }
}

document.getElementById('connectBtn').onclick = connectAndChat;
document.getElementById('sendBtn').onclick = sendMsg;
document.getElementById('msgInput').addEventListener('keypress', e=>{if(e.key==='Enter')sendMsg();});
async function sendMsg() {
  if(!connected) return;
  let msg = document.getElementById('msgInput').value.trim();
  if(!msg) return;
  const data = new TextEncoder().encode(msg);
  try {
    await charac.writeValue(data);
  } catch(e){
    addMsg('âŒ å‘é€å¤±è´¥: ' + e.message, 'in');
  }
  addMsg(msg, 'out');
  document.getElementById('msgInput').value = '';
}
</script>
</body>
</html>
